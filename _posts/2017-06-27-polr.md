---
layout: post
title:  "Deordinalization"
author: Paul L. Maurizio
date: 2017-07-06
categories: stats mapping
use_math: true

---

## Motivation

_Note: This post is a work in progress for a manuscript under preparation. I hope to document these adventures more fully in the supplemental methods of the final manuscript._

We are interested in finding host quantitative trait loci (QTL) controlling pathology in the lung following influenza virus infection in mice. We have a Collaborative Cross Recombinant Inbred Cross (CC-RIX, or CC-F1) panel that has been infected with influenza A virus (CA04), and we have 12 histology scores measured on day 10 (D10) post-infection.

However, before we do any QTL mapping, we observe that the distribution of the data we have for the histology tissues is not normal--it is distributed as a categorical (ordinal) set of scores, ranging from very mild to very severe. These scores are represented by integer (and half-integer) values, but are not necessarily best modeled as numeric. One option is to "deordinalize" the phenotypes, using ordinal logistic regression, generating a normally distributed data set.

## Deordinalization

I summarize the following model we are using for our data, from the following reference: 

* Gelman and Hill (2007) [Data Analysis Using Regression and Multilevel/Hierarchical Models](https://doi.org/10.1017/CBO9780511790942.008): &sect; 6.5 "Multinomial regression"; &sect; 15.2 "Ordered categorical regression: storable votes"; and &sect; 17.6 "Multilevel ordered categorial regression".

Additional resources include:

* Faraway (2016) [Extending the Linear Model with R](https://www.crcpress.com/Extending-the-Linear-Model-with-R-Generalized-Linear-Mixed-Effects-and/Faraway/p/book/9781498720960): &sect; 5.3 "Ordinal Multinomial Responses"

* Venables and Ripley (2002) [Modern Applied Statistics with S](http://www.springer.com/us/book/9780387954578): &sect; 7.3 "Poisson and Multinomial Models"

* Agresti (2012) [Categorical Data Analysis](http://www.wiley.com/WileyCDA/WileyTitle/productCd-0470463635.html): &sect; 7 "Logit Models for Multinomial Responses" and &sect; 12.4 "Random Effects Models for Multinomial Data"; also ICDA: [software supplement](http://www.stat.ufl.edu/~aa/cda/software.html) and [R and S-PLUS Manual to Accompany CDA](https://web.archive.org/web/20151002190955/https://home.comcast.net/~lthompson221/Splusdiscrete2.pdf).

* McCullagh and Nelder (1989) [Generalized Linear Models](https://www.crcpress.com/Generalized-Linear-Models-Second-Edition/McCullagh-Nelder/p/book/9780412317606) &sect; 5.1 "Models for polytomous data"

* Fullerton and Xu (2016) [Ordered Regression Models](http://www.crcnetbase.com/doi/book/10.1201/b20060): &sect; 2 "Parallel Models"

Our data can be described as arising from a multinomial distribution, where, for {% raw %}{::nomarkdown}$y \in \{ 1, 2, \dots, K \} ${:/}{% endraw%}, we have a set of probabilities:

{% raw %}{::nomarkdown}
    <div>
    \begin{equation}
	Pr(y > 1) = \text{logit}^{-1}(X \beta)
	\end{equation}
    </div>
{:/}{% endraw %}

{% raw %}{::nomarkdown}
    <div>
    \begin{equation}
	Pr(y > 2) = \text{logit}^{-1}(X \beta - c_2)
	\end{equation}
    </div>
{:/}{% endraw %}

{% raw %}{::nomarkdown}
    <div>
    \begin{equation}
	Pr(y > 3) = \text{logit}^{-1}(X \beta - c_3)
	\end{equation}
    </div>
{:/}{% endraw %}

{% raw %}{::nomarkdown}
    <div>
    \begin{equation}
	\dots \nonumber
	\end{equation}
    </div>
{:/}{% endraw %}

{% raw %}{::nomarkdown}
    <div>
    \begin{equation}
	Pr(y > K - 1) = \text{logit}^{-1}(X \beta - c_{K-1})
	\end{equation}
    </div>
{:/}{% endraw %}

The parameters {% raw %}{::nomarkdown}$c_1${:/}{% endraw%} through {% raw %}{::nomarkdown}$c_{K-1}${:/}{% endraw%} are the *cutpoints*. For any possible given {% raw %}{::nomarkdown}$k${:/}{% endraw%},

{% raw %}{::nomarkdown}
    <div>
    \begin{equation}
	Pr(y=k) = Pr(y > k-1) - Pr(y>k).
	\end{equation}
    </div>
{:/}{% endraw %}

There is an alternative formulation for logistic regression which uses a *latent variable* which is used to define the cutpoints for classification of each of the {% raw %}{::nomarkdown}$y${:/}{% endraw%} outcomes. For each individual, {% raw %}{::nomarkdown}$i${:/}{% endraw%}, a latent variable, {% raw %}{::nomarkdown}$z_i${:/}{% endraw%} is given, and the value of that variable determines the value of the {% raw %}{::nomarkdown}$y_i${:/}{% endraw%} outcome. The latent variable is modeled using a linear model where the errors are distributed in a *logistic* fashion.

McCullagh (1980, *J Royal Stat Soc B-Methodological*) describes the continuous latent variable as a "tolerance" value, which may be an unobservable, latent biological quantity of interest. 

A help page for a Bayesian proportional odds logistic regression function, `bayespolr()`, from the `arm` package, is here: [bayespolr help](https://www.rdocumentation.org/packages/arm/versions/1.9-3/topics/bayespolr). It uses BFGS and the `optim()` package. In contrast to `polr()`, which has no intercept, `bayespolr()` will force an intercept into the model. There is also `vglm()` from the [`VGAM` library](https://www.stat.auckland.ac.nz/~yee/VGAM/). There is the `clmm()` function in the `ordinal` package that allows cumulative logit models with random effects (Laplace approx.). 

## Some useful R packages and functions

```
library(MCMCpack)
MCMCoprobit()

library(VGAM)
vglm()

library(ordinal)
clm(); clmm()

library(MASS)
polr()

library(ARM)
bayespolr()

library(brms)
brm()
```

## Cumulative Probit model with BRMS

{% raw %}{::nomarkdown}
    <div>
    \begin{equation}
    y_i \sim D(f(\eta_i), \theta)
    \end{equation}
    </div>
{:/}{% endraw %}

{% raw %}{::nomarkdown}
    <div>
    \begin{equation}
    \eta_i = \boldsymbol{X}\beta + \boldsymbol{Z}_{\text{cross}}u_{\text{cross}} + \boldsymbol{Z}_{\text{batch}}u_{\text{batch}}
    \end{equation}
    </div>
{:/}{% endraw %}

{% raw %}{::nomarkdown}
    <div>
    \begin{equation}
    u_{\text{cross}} \sim \text{student-t}(0, \boldsymbol{\sigma}_{\text{cross}})
    \end{equation}
    </div>
{:/}{% endraw %}

{% raw %}{::nomarkdown}
    <div>
    \begin{equation}
    u_{\text{batch}} \sim \text{student-t}(0, \boldsymbol{\sigma}_{\text{batch}})
    \end{equation}
    </div>
{:/}{% endraw %}

{% raw %}{::nomarkdown}
    <div>
    \begin{equation}
    P(c_k | \mu, d) = \phi(d*(c_k - \mu)) - \phi(d*(c_{k-1} - \mu))
    \end{equation}
    </div>
{:/}{% endraw %}

where {% raw %}$\phi()${% endraw %} is the cumulative unit normal distribution function.

## Key reference:

* Peter McCullagh, 1980, *J Royal Stat Soc B-Methodological*, "Regression Models for Ordinal Data"

